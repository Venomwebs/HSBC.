(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{"3y+j":function(e,t,n){},NJR1:function(e,t,n){},T02G:function(e,t,n){"use strict";var a=n("+vh4"),r=n("ljQm"),c=n("tNhX"),o=n("P6UB");t.a=function UseStoreSync(e){var t=e.store,n=e.syncWith,s=e.name;return Object(o.b)({topic:"CONDUCTOR:action-from-".concat(n),handler:function handler(e){t.dispatch(Object(a.a)({},e.data.action,{_foreignDispatch:!0}))}}),Object(c.a)(r.a["".concat(s.toUpperCase(),"_READY")]),t}},ViIZ:function(e,t,n){"use strict";var a=n("ERkP"),r=n.n(a),c=n("WvuA"),o=n("PCyI");n("NJR1");t.a=function MessageCloseButton(e){var t=e.onClick;return r.a.createElement(o.a,{onClick:t,className:"drift-widget-message-close-button","aria-label":"close"},r.a.createElement(c.a,{width:8,height:8}))}},dYd6:function(e,t,n){"use strict";n.r(t);var a=n("mj2O"),r=n.n(a),c=n("7SM1"),o=n("s8DI"),s=(n("z8n0"),n("JBtm")),i=n.n(s),u=n("ERkP"),l=n.n(u),d=n("uDfI"),p=n("uiOv"),f=n("+vh4"),b=(n("3y+j"),n("O94r")),h=n.n(b),v=n("LVcX"),g=n("0B8E"),O=(n("pUpc"),n("i9gz")),m=n("DboL"),j=n("RhEL"),_=n("3atR"),y=n("PCyI"),w=n("ViIZ"),k=function useIsBotMessage(e){return Object(u.useMemo)(function(){return Object(v.a)(!1,["attributes","isBot"],e)},[e])},x=n("/685"),C=n("gB0i"),E=n("417H"),I=n("v7P+"),S=n("HYPW"),A=n("P6UB"),T=n("XS0u"),M=T.a.sismember,P=function MessagePreview(e){var t=e.open,n=Object(u.useRef)(null),a=Object(d.b)(),s=Object(u.useState)(null),i=Object(o.a)(s,2),p=i[0],f=i[1],b=Object(u.useState)(!1),h=Object(o.a)(b,2),v=h[0],g=h[1],T=Object(d.c)(function(e){return e.conversations}).activeConversation,P=Object(d.c)(function(e){return e.campaigns}).activeCampaign,R=Object(d.c)(function(e){return T&&e.conversations.messages[T]||{}}),N=function resetControllerSize(){Object(A.a)({topic:"reset-controller-size"})};Object(u.useEffect)(function(){!function(){var e=Object(c.a)(r.a.mark(function _callee(){var e,t;return r.a.wrap(function _callee$(n){for(;;)switch(n.prev=n.next){case 0:if(p){n.next=2;break}return n.abrupt("return");case 2:return n.next=4,M("messagesSeen",p.id);case 4:e=n.sent,t=e.data,g(t);case 7:case"end":return n.stop()}},_callee)}));return function getHasSeen(){return e.apply(this,arguments)}}()()},[p,t]);var U=Object(u.useMemo)(function(){return!t&&!v&&function isAgentMessage(e){return e&&(e.contentType===_.b.CHAT||e.contentType===_.b.ANNOUNCEMENT)&&"USER"===e.authorType}(p)},[p,t,v]),L=Object(u.useMemo)(function(){return!U||!p||!p.body||!p.body.length||"Read"===p.viewerRecipientStatus},[U,p]),D=Object(x.a)().markAsRead;Object(u.useEffect)(function setLatestMessageFromConvo(){if(!Object(O.a)(R)){var e=Object(E.g)(Object(m.a)(R)).pop()||{};p&&Object(j.a)(e.id,p.id)||f(Object(E.i)(e,100))}},[R]),Object(u.useLayoutEffect)(function updateFrameSize(){if(p){var e=n.current?n.current.clientWidth:22,a=n.current?n.current.clientHeight:22,r=!t&&!L,c=r?"".concat(e+76+40,"px"):"76px",o=r?"".concat(a+36>76?a+36:76,"px"):"76px";Object(A.a)({topic:"set-frame-width",message:{width:c,name:"controller"}}),Object(A.a)({topic:"set-frame-height",message:{height:o,name:"controller",max:!1}})}},[n,p,L]);var B=P?P.id:null,$=p?p.id:B,V=Object(E.a)(P,"campaignId"),F=k(p);if(Object(C.a)(V,$,!!V),L||!p)return null;return l.a.createElement("div",{className:"drift-widget-message-preview-wrapper",key:"".concat(p.id,"-preview-box")},l.a.createElement("div",{className:"drift-widget-message-preview"},l.a.createElement(w.a,{onClick:function dismiss(){p&&(D(T),f({}),N(),F&&Object(S.m)(p))}}),l.a.createElement(y.a,{onClick:function openChat(){N(),D(T),F&&Object(S.l)(p),a(Object(I.a)({chatOpen:!0}))},className:"drift-widget-message-preview-text"},l.a.createElement("p",{ref:n},p.attributes.preview))))},R=n("j2Ij"),N=n("T4tG"),U=n("cv42"),L=n("3B44"),D=function useThemeIcon(){var e=Object(d.c)(function(e){return e.embed.configuration}).theme,t=e.iconStyle,n=e.iconUrl,a=e.foregroundColor,r={SOLID1:l.a.createElement(N.i,{fill:"#".concat(a)}),SOLID2:l.a.createElement(N.h,{fill:"#".concat(a)}),OUTLINE1:l.a.createElement(N.f,{fill:"#".concat(a)}),OUTLINE2:l.a.createElement(N.g,{fill:"#".concat(a)}),BOLT:N.c};return{customIcon:n?{backgroundImage:"url(".concat(n,")"),backgroundSize:"cover",backgroundRepeat:"no-repeat"}:{},hasCustomIcon:!!n,Icon:r[t]||null}},B=n("wdGO"),$=n("uBK8"),V=n("WwEg"),F=n("pqMu"),W=n("mfas"),H=n("67PG"),G=n("GWID"),J=n("5Fu3"),z=n("NsSs"),q=n("YXQ5"),Y=n("dn/m"),K=function receiveEmbedConfiguration(e){return Object(Y.a)({type:"RECEIVE_EMBED_CONFIGURATION",payload:e})},Q=n("+RM2"),Z=n("8eNW"),X=n("Gi4y"),ee=n("K0Zh"),te=n("Maj3"),ne=n("Nlzp"),ae=function enrollCampaign(e,t,n){return ne.d.post("campaigns/".concat(e,"/enroll"),{senderId:t,sessionId:n})},re=n("6rLW"),ce=n("fK6p"),oe=n("7Qib"),se=n("Jstd"),ie=n("4Zd6"),ue=n("Bmr4"),le=n("rAc1"),de=n("l6A5"),pe=function memoizeUntil(e,t){var n=!1;return Object(de.a)(function timeBased(e){return setTimeout(function(){return n=!0},t),n&&setTimeout(function(){return n=!1},0),Object(le.a)(n)},e)}(Object(c.a)(r.a.mark(function _callee(){var e,t,n;return r.a.wrap(function _callee$(a){for(;;)switch(a.prev=a.next){case 0:return e=J.a.getState().embed.id,a.next=3,Object(re.d)(e);case 3:return t=a.sent,n=t.data,a.abrupt("return",n);case 6:case"end":return a.stop()}},_callee)})),5e3),fe=function(){var e=Object(c.a)(r.a.mark(function _callee2(){var e;return r.a.wrap(function _callee2$(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,pe();case 3:return e=t.sent,t.abrupt("return",Object(v.a)(!1,["driftOnline"],e));case 7:return t.prev=7,t.t0=t.catch(0),Object(oe.e)("Failed to fetch online status -  ".concat(t.t0.message),t.t0),t.abrupt("return",!1);case 11:case"end":return t.stop()}},_callee2,null,[[0,7]])}));return function getIsOnline(){return e.apply(this,arguments)}}(),be=function(){var e=Object(c.a)(r.a.mark(function _callee3(e){var t;return r.a.wrap(function _callee3$(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,he();case 2:return t=n.sent,n.abrupt("return",t.includes(e));case 4:case"end":return n.stop()}},_callee3)}));return function getIsTeamAvailable(t){return e.apply(this,arguments)}}(),he=function(){var e=Object(c.a)(r.a.mark(function _callee4(){var e,t;return r.a.wrap(function _callee4$(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,pe();case 3:return e=n.sent,t=e.availableTeams||[],n.abrupt("return",t);case 8:return n.prev=8,n.t0=n.catch(0),Object(oe.e)("Failed to fetch team availability"),n.abrupt("return",[]);case 12:case"end":return n.stop()}},_callee4,null,[[0,8]])}));return function getTeamAvailability(){return e.apply(this,arguments)}}(),ve=n("S5C5"),ge=function isAnyOf(e,t){return Object(se.a)(function(e){return t===e})(e)},Oe=function notIsAnyOf(e,t){return!ge(e,t)},me=function is(e,t){return e===t},je=function notIs(e,t){return e!==t},_e=function isMatch(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return Array.isArray(e)||(e=[e]),Object(se.a)(function(e){return e.test(t)})(e)},ye=function lessThan(e,t){return t<e},we=function greaterThan(e,t){return t>e},ke=function isBetween(e,t){return!!e.min&&!!e.max&&t>=e.min&&t<=e.max},xe=function includesAnyOf(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return Object(se.a)(function(e){return-1!==t.indexOf(e)})(e)},Ce=function notIncludesAnyOf(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return Object(ie.a)(function(e){return-1===t.indexOf(e)})(e)},Ee=function intersectionEmpty(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return Object(se.a)(function(e){return-1===t.indexOf(e)})(e)},Ie=function notIntersectionEmpty(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return Object(se.a)(function(e){return-1!==t.indexOf(e)})(e)},Se={device:{async:!1,selector:function selector(e){return function resolveDeviceType(e){var t=e.toLowerCase();return t.match(/(mobi|phone|ipod|blackberry|docomo|iphone|android)/i)?"mobile":t.match(/(ipad|kindle)/i)?"tablet":"desktop"}(Object(v.a)("",["_window","userAgent"])(e))},operands:{isAnyOf:ge,notIsAnyOf:Oe}},siteVisits:{async:!1,selector:function selector(e){return Object(v.a)(0,["visitInformation","total"])(e)},operands:{is:me,notIs:je,lessThan:ye,greaterThan:we,isBetween:ke}},daysSinceLastVisit:{async:!1,selector:function selector(e){return Object(v.a)(0,["visitInformation","daysSinceLastVisit"])(e)},operands:{is:me,notIs:je,lessThan:ye,greaterThan:we,isBetween:ke}},url:{async:!1,transformValueFn:function transformValueFn(e){return e.map(function(e){return Object(ve.b)(e)})},selector:function selector(e){return Object(ve.b)(Object(v.a)("",["_window","location","href"])(e))},operands:{is:me,notIs:je,isMatch:_e,notIsMatch:function notIsMatch(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return!_e(e,t)},isAnyOf:ge,notIsAnyOf:Oe,includesAnyOf:xe,notIncludesAnyOf:Ce}},urlPath:{async:!1,selector:function selector(e){return Object(v.a)("",["_window","location","pathname"])(e)},operands:{is:me,notIs:je,isAnyOf:ge,notIsAnyOf:Oe,includesAnyOf:xe,notIncludesAnyOf:Ce,startsWith:function startsWith(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return Object(se.a)(function(e){return 0===t.indexOf(e)})(e)}}},urlHost:{async:!1,selector:function selector(e){return Object(v.a)("",["_window","location","hostname"])(e)},operands:{is:me,notIs:je,isAnyOf:ge,notIsAnyOf:Oe,includesAnyOf:xe,notIncludesAnyOf:Ce}},urlQuery:{async:!1,selector:function selector(e){return Object(v.a)("",["_window","location","search"])(e).replace("?","")},operands:{is:me,notIs:je,isAnyOf:ge,notIsAnyOf:Oe,includesAnyOf:xe,notIncludesAnyOf:Ce}},referrer:{async:!1,transformValueFn:function transformValueFn(e){return e.map(function(e){return Object(ve.b)(e)})},selector:function selector(e){return Object(ve.b)(Object(v.a)("",["referrer"])(e))},operands:{is:me,notIs:je,isAnyOf:ge,notIsAnyOf:Oe,includesAnyOf:xe,notIncludesAnyOf:Ce}},geoCountryCode:{async:!1,selector:function selector(e){return Object(v.a)("",["geo","country"])(e)},operands:{is:me,notIs:je,isAnyOf:ge,notIsAnyOf:Oe}},geoGermanState:{async:!1,selector:function selector(e){return Object(v.a)("",["geo","subdivision"])(e)},operands:{isAnyOf:ge,notIsAnyOf:Oe}},geoCanadianProvince:{async:!1,selector:function selector(e){return Object(v.a)("",["geo","subdivision"])(e)},operands:{isAnyOf:ge,notIsAnyOf:Oe}},geoState:{async:!1,selector:function selector(e){return Object(v.a)("",["geo","subdivision"])(e)},operands:{is:me,notIs:je,isAnyOf:ge,notIsAnyOf:Oe}},geoMetroCode:{async:!1,selector:function selector(e){return Object(v.a)("",["geo","metroCode"])(e)},operands:{is:me,notIs:je,isAnyOf:ge,notIsAnyOf:Oe}},geoIp:{async:!1,selector:function selector(e){return Object(v.a)("",["geo","ip"])(e)},operands:{is:me,notIs:je,isAnyOf:ge,notIsAnyOf:Oe}},geoPostalCode:{async:!1,selector:function selector(e){return Object(v.a)("",["geo","postalCode"])(e)},operands:{isAnyOf:ge,notIsAnyOf:Oe}},cookie:{async:!1,selector:function selector(e){return Object.entries(Object(v.a)({},["cookies"])(e)).map(function(e){return e.join("=")})},operands:{is:me,notIs:je,isAnyOf:ge,notIsAnyOf:Oe,includesAnyOf:xe,notIncludesAnyOf:Ce}},scrollPct:{async:!0,eventType:"scroll",selector:function selector(e){var t=Object(v.a)(0,["_window","scrollY"])(e);return(Object(v.a)(0,["_window","innerHeight"])(e)+t)/Object(v.a)(0,["scrollableHeight"])(e)*100},operands:{lessThan:ye,greaterThan:we,isBetween:ke}},secondsOnPage:{async:!0,timer:!0,eventType:"timer",selector:function selector(e){var t=Object(v.a)(0,["_window","drift_page_view_started"])(e);return Math.floor((new Date).getTime()/1e3)-t},operands:{lessThan:ye,greaterThan:we}},secondsOnSite:{async:!0,timer:!0,eventType:"timer",selector:function selector(e){var t=Object(v.a)(0,["_window","drift_session_started"])(e);return Math.floor((new Date).getTime()/1e3)-t},operands:{lessThan:ye,greaterThan:we}},online:{async:!1,selector:function(){var e=Object(c.a)(r.a.mark(function _callee(e){return r.a.wrap(function _callee$(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fe();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},_callee)}));return function selector(t){return e.apply(this,arguments)}}(),operands:{is:me,notIs:je}},clearbit:{async:!1,selector:function selector(e,t){var n=Object(v.a)({},["intel","intelConditions"],e);return!!Object(ue.a)([t.value],n)&&n[t.value]},operands:{clearbit:me}},demandbase:{async:!1,selector:function(){var e=Object(c.a)(r.a.mark(function _callee2(e,t){var n;return r.a.wrap(function _callee2$(a){for(;;)switch(a.prev=a.next){case 0:if(n=Object(v.a)({},["intel","intelConditions"],e),Object(ue.a)([t.value],n)){a.next=3;break}return a.abrupt("return",!1);case 3:return a.abrupt("return",n[t.value]);case 4:case"end":return a.stop()}},_callee2)}));return function selector(t,n){return e.apply(this,arguments)}}(),operands:{demandbase:me}},exitIntent:{async:!1,selector:function selector(e){return!1},operands:{is:me}},outboundSession:{async:!1,selector:function selector(e){return Object(v.a)(!1,["session","isOutbound"])(e)},operands:{is:me,notIs:je}},autoAssigneeId:{async:!1,selector:function selector(e){return Object(v.a)("",["embed","configuration","autoAssigneeId"])(e)},operands:{is:me,notIs:je,isAnyOf:ge,notIsAnyOf:Oe}},targetAccount:{async:!1,selector:function selector(e){return Object(v.a)(!1,["intel","account","targeted"],e)},operands:{is:me,notIs:je}},targetAccountOwnerId:{async:!1,selector:function selector(e){return Object(v.a)(null,["intel","account","ownerId"],e)},operands:{is:me,notIs:je,isAnyOf:ge,notIsAnyOf:Oe}},teamAvailability:{async:!0,selector:function(){var e=Object(c.a)(r.a.mark(function _callee3(e,t){return r.a.wrap(function _callee3$(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,be(t.value[0]);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},_callee3)}));return function selector(t,n){return e.apply(this,arguments)}}(),operands:{isAvailable:function isAvailable(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];return!!e},isNotAvailable:function isNotAvailable(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];return!e}}},contactSegment_marketo:{async:!1,selector:function(){var e=Object(c.a)(r.a.mark(function _callee4(e){return r.a.wrap(function _callee4$(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(v.a)([],["intel","contactSegments"],e));case 1:case"end":return t.stop()}},_callee4)}));return function selector(t){return e.apply(this,arguments)}}(),operands:{intersectionEmpty:Ee,notIntersectionEmpty:Ie}},contactSegment:{async:!1,selector:function selector(e){return Object(v.a)([],["intel","contactSegments"],e)},operands:{intersectionEmpty:Ee,notIntersectionEmpty:Ie}},accountSegment:{async:!1,selector:function selector(e){return Object(v.a)([],["intel","accountSegments"],e)},operands:{intersectionEmpty:Ee,notIntersectionEmpty:Ie}},inboxId:{async:!1,selector:function selector(e){return Object(v.a)("",["embed","configuration","inboxId"])(e)},operands:{isAnyOf:ge,notIsAnyOf:Oe}}},Ae=function isUnsupportedCondition(e){return!Se[e.field]},Te=function(){var e=Object(c.a)(r.a.mark(function _callee(e,t){var n,a,c,o,s,i;return r.a.wrap(function _callee$(r){for(;;)switch(r.prev=r.next){case 0:if(!Ae(e)){r.next=2;break}return r.abrupt("return",Promise.resolve({conditionEvaluation:!1,conditionEvalDetail:{evaluatedCondition:e,matched:!1,status:"PENDING"}}));case 2:return n=Se[e.field],a=n.operands[e.operator],c=n.transformValueFn?n.transformValueFn(e.value):e.value,r.next=7,n.selector(t,e);case 7:return o=r.sent,s=a(c,o),i={evaluatedCondition:e,matched:s,actualValue:o,status:n.async?s?"EVALUATED":"PENDING":"EVALUATED"},r.abrupt("return",Promise.resolve({conditionEvaluation:s,conditionEvalDetail:i}));case 11:case"end":return r.stop()}},_callee)}));return function evaluateSingleCondition(t,n){return e.apply(this,arguments)}}(),Me=function conditionEvaluator(e){return function(t){return Te(e,t)}},Pe=function(){var e=Object(c.a)(r.a.mark(function _callee3(e){var t,n,a,o,s,i,u,l,d,p,f,b,h,v,g;return r.a.wrap(function _callee3$(O){for(;;)switch(O.prev=O.next){case 0:t=e.context,n=e.conditions,a=!1,o=[],s=[],i=function(){var e=Object(c.a)(r.a.mark(function _callee2(e){var n,a,c,s,i,u,l,d,p,f,b,h,v,g,O;return r.a.wrap(function _callee2$(m){for(;;)switch(m.prev=m.next){case 0:n=!0,a=[],m.t0=r.a.keys(e);case 3:if((m.t1=m.t0()).done){m.next=23;break}return c=m.t1.value,s=e[c],m.next=8,Te(s,t);case 8:if(i=m.sent,u=i.conditionEvalDetail,l=i.conditionEvaluation,a.push(u),l||Ae(u.evaluatedCondition)){m.next=21;break}if(d=Se[s.field],p=d.async,f=void 0!==p&&p,b=d.eventType,h=void 0===b?null:b,v=d.timer,g=void 0!==v&&v,O=d.selector,n=!1,!f){m.next=19;break}o.push({conditionDefinition:s,selector:O,eventType:h,timer:g,type:s.field,evaluator:Me(s)}),m.next=21;break;case 19:return o=[],m.abrupt("break",23);case 21:m.next=3;break;case 23:return m.abrupt("return",Promise.resolve({fullGroupMatch:n,groupEval:{targetingConditions:a,status:o.length?"PENDING":"EVALUATED"}}));case 24:case"end":return m.stop()}},_callee2)}));return function evaluateConditions(t){return e.apply(this,arguments)}}(),u=!0,l=!1,d=void 0,O.prev=8,p=n[Symbol.iterator]();case 10:if(u=(f=p.next()).done){O.next=25;break}return b=f.value,O.next=14,i(b);case 14:if(h=O.sent,v=h.fullGroupMatch,g=h.groupEval,s.push(g),!v){O.next=22;break}return a=!0,o=[],O.abrupt("break",25);case 22:u=!0,O.next=10;break;case 25:O.next=31;break;case 27:O.prev=27,O.t0=O.catch(8),l=!0,d=O.t0;case 31:O.prev=31,O.prev=32,u||null==p.return||p.return();case 34:if(O.prev=34,!l){O.next=37;break}throw d;case 37:return O.finish(34);case 38:return O.finish(31);case 39:return O.abrupt("return",Promise.resolve({matched:a,asyncConditionListeners:o,evalLog:s}));case 40:case"end":return O.stop()}},_callee3,null,[[8,27,31,39],[32,,34,38]])}));return function evaluateTargetingConditions(t){return e.apply(this,arguments)}}(),Re=n("LxuR"),Ne=n("ocZZ"),Ue=function(){var e=Object(c.a)(r.a.mark(function _callee(){var e,t,n,a,c=arguments;return r.a.wrap(function _callee$(r){for(;;)switch(r.prev=r.next){case 0:if((e=c.length>0&&void 0!==c[0]?c[0]:[]).length){r.next=3;break}return r.abrupt("return",Promise.resolve([]));case 3:return r.prev=3,t=Object(de.a)(le.a,function(e){return Object(re.b)(e)},5e3),r.next=7,t(e);case 7:n=r.sent,a=n.data,J.a.dispatch(Object(Re.b)(a)),r.next=16;break;case 12:return r.prev=12,r.t0=r.catch(3),Object(Ne.a)(new Error("Failed to fetch membership status")),r.abrupt("return",Promise.resolve([]));case 16:case"end":return r.stop()}},_callee,null,[[3,12]])}));return function getContactSegmentMemberships(){return e.apply(this,arguments)}}(),Le=function getSegmentMembershipsForCampaigns(){var e=Object(v.a)({},["embed","configuration"],J.a.getState()),t=e.campaigns,n=void 0===t?[]:t,a=e.rules,r=void 0===a?[]:a,c=e.theme,o=void 0===c?{}:c,s=n.map(function(e){return e.conditions}),i=r.map(function(e){return e.conditions}),u=Object(ee.a)([].concat(Object(V.a)(s),Object(V.a)(i),Object(V.a)(o.conditions),Object(V.a)(o.userListIds)));return Be(u)},De=function getConditionalSkillContactSegments(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return Be(e)},Be=function _getContactSegmentsForConditions(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).filter(function(e){return"contactSegment"===e.field||"contactSegment_marketo"===e.field});return Object(te.a)(function(e){return e.value},e)},$e=n("UzjA"),Ve="EVERYONE",Fe="PREVIOUS",We="SEGMENT",He="USERS",Ge="NONE",Je=function(){var e=Object(c.a)(r.a.mark(function _callee(){var e,t,n,a,c,o,s,i,u,l,d,p,f,b,h,v,g,O;return r.a.wrap(function _callee$(r){for(;;)switch(r.prev=r.next){case 0:return e=J.a.getState(),t=e.embed,n=e.session,a=e.targeting,r.next=3,Object(A.a)({topic:"get-host-window"});case 3:return c=r.sent,o=c.data,s=void 0===o?{}:o,r.next=8,Object(A.a)({topic:"get-host-cookies"});case 8:return i=r.sent,u=i.data,l=void 0===u?{}:u,r.next=13,Object(A.a)({topic:"get-host-referrer"});case 13:return d=r.sent,p=d.data,f=void 0===p?"":p,r.next=18,Object(A.a)({topic:"get-scrollable-height"});case 18:return b=r.sent,h=b.data,r.next=22,T.a.get("visitCounts");case 22:return v=r.sent,g=v.data,O={_window:s,visitInformation:void 0===g?{}:g,cookies:l,geo:n.geo,embed:t,intel:a,referrer:f,scrollableHeight:h},r.abrupt("return",Promise.resolve(O));case 27:case"end":return r.stop()}},_callee)}));return function generateTargetingContext(){return e.apply(this,arguments)}}(),ze=function isWithinWidgetTargetingAudience(){var e=J.a.getState(),t=e.embed,n=e.session,a=e.conversations,r=e.targeting,c=Object(v.a)("LEAD",["endUser","type"],n),o=!Object(O.a)(a.conversations),s=Object(v.a)(!0,["configuration","theme","audience"],t),i=Object(v.a)([],["configuration","theme","userListIds"],t),u=Object(v.a)([],["contactSegments"],r);return s!==Ge&&(s===Ve||(s===Fe?o:s===He?"END_USER"===c:s===We?Object(ce.a)(u,i).length>0:void 0))},qe=function(){var e=Object(c.a)(r.a.mark(function _callee2(){var e,t,n,a,c,o,s,i;return r.a.wrap(function _callee2$(r){for(;;)switch(r.prev=r.next){case 0:if(e=J.a.getState(),t=e.embed,n=function shouldNotRenderCallback(){return Promise.resolve({matched:!1,asyncConditionListeners:[]})},Object(v.a)(!0,["configuration","chatEnabled"],t)){r.next=5;break}return r.abrupt("return",n());case 5:if(ze()){r.next=8;break}return r.abrupt("return",n());case 8:return r.next=10,Je();case 10:if(a=r.sent,!(c=Object(v.a)([],["configuration","theme","conditions"],t)).length){r.next=21;break}return r.next=15,Pe({conditions:c,context:a});case 15:return o=r.sent,s=o.matched,i=o.asyncConditionListeners,r.abrupt("return",Promise.resolve({matched:s,asyncConditionListeners:i}));case 21:return r.abrupt("return",Promise.resolve({matched:!0,asyncConditionListeners:[]}));case 22:case"end":return r.stop()}},_callee2)}));return function shouldWidgetRender(){return e.apply(this,arguments)}}(),Ye=function(){var e=Object(c.a)(r.a.mark(function _callee5(e){var t,n,a,o,s,i;return r.a.wrap(function _callee5$(u){for(;;)switch(u.prev=u.next){case 0:return t=e.onMatched,n=void 0===t?function(){}:t,a=e.onDidNotMatch,o=void 0===a?function(){}:a,u.next=3,qe();case 3:s=u.sent,i=s.matched,s.asyncConditionListeners.forEach(function(){var e=Object(c.a)(r.a.mark(function _callee4(e){var t,a,o,s,i;return r.a.wrap(function _callee4$(u){for(;;)switch(u.prev=u.next){case 0:if(t=Object(oe.m)(),a=function(){var a=Object(c.a)(r.a.mark(function _callee3(){var a;return r.a.wrap(function _callee3$(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,Je();case 2:a=r.sent,e.evaluator(a)&&(e.eventType&&Object(A.a)({topic:"remove-host-event-listener",message:{id:t,event:e.eventType}}),Ye(n));case 5:case"end":return r.stop()}},_callee3)}));return function conditionHandler(){return a.apply(this,arguments)}}(),!e.timer){u.next=11;break}return u.next=5,Je();case 5:o=u.sent,s=e.conditionDefinition.value,(i=s-e.selector(o))>0&&setTimeout(a,1e3*i+1e3),u.next=12;break;case 11:Object(A.a)({topic:"add-host-event-listener",message:{id:t,event:e.eventType,handler:a}});case 12:case"end":return u.stop()}},_callee4)}));return function(t){return e.apply(this,arguments)}}()),i?n():o();case 8:case"end":return u.stop()}},_callee5)}));return function evaluateWidgetTargetingConditions(t){return e.apply(this,arguments)}}(),Ke=function(){var e=Object(c.a)(r.a.mark(function _callee6(){var e,t,n,a,c,s,i,u,l,d,p,b,h,v,g,O,m,j,_,y=arguments;return r.a.wrap(function _callee6$(r){for(;;)switch(r.prev=r.next){case 0:return e=y.length>0&&void 0!==y[0]?y[0]:[],r.next=3,Je();case 3:if(t=r.sent,n=pt(e),a=bt(n),c=De(n),!a.length){r.next=10;break}return r.next=10,Object($e.a)(a);case 10:if(!c.length){r.next=13;break}return r.next=13,Ue(c);case 13:s=Object(f.a)({conditionGroups:[]},dt()),i=!0,u=!1,l=void 0,r.prev=17,d=e.entries()[Symbol.iterator]();case 19:if(i=(p=d.next()).done){r.next=34;break}return b=p.value,h=Object(o.a)(b,2),v=h[0],g=h[1],r.next=26,Pe({conditions:g.conditionSets,context:t});case 26:O=r.sent,m=O.matched,j=O.evalLog,_=void 0===j?[]:j,s.conditionGroups.push({status:"EVALUATED",matched:m,conditionSets:_,key:"".concat(g.outputKey,"-").concat(g.label),priority:v+1});case 31:i=!0,r.next=19;break;case 34:r.next=40;break;case 36:r.prev=36,r.t0=r.catch(17),u=!0,l=r.t0;case 40:r.prev=40,r.prev=41,i||null==d.return||d.return();case 43:if(r.prev=43,!u){r.next=46;break}throw l;case 46:return r.finish(43);case 47:return r.finish(40);case 48:return r.abrupt("return",s);case 49:case"end":return r.stop()}},_callee6,null,[[17,36,40,48],[41,,43,47]])}));return function evaluateTargetingForConditionalSets(){return e.apply(this,arguments)}}(),Qe=function(){var e=Object(c.a)(r.a.mark(function _callee8(){var e,t,n,a,o=arguments;return r.a.wrap(function _callee8$(s){for(;;)switch(s.prev=s.next){case 0:if((e=o.length>0&&void 0!==o[0]?o[0]:[]).length){s.next=3;break}return s.abrupt("return",{matchedCampaign:null});case 3:return t=J.a.getState().embed.configuration.campaigns,n=t.filter(function(t){return e.includes(t.id)}),a=function(){var e=Object(c.a)(r.a.mark(function _callee7(){var e,t,a,c,o,s,i,u;return r.a.wrap(function _callee7$(r){for(;;)switch(r.prev=r.next){case 0:e=!0,t=!1,a=void 0,r.prev=3,c=n[Symbol.iterator]();case 5:if(e=(o=c.next()).done){r.next=21;break}if((s=o.value).conditions.length||s.audience===Ge){r.next=9;break}return r.abrupt("return",Promise.resolve({matchedCampaign:s.id}));case 9:return r.next=11,Je();case 11:return i=r.sent,r.next=14,Pe({conditions:s.conditions,context:i});case 14:if(u=r.sent,!u.matched){r.next=18;break}return r.abrupt("return",Promise.resolve({matchedCampaign:s.id}));case 18:e=!0,r.next=5;break;case 21:r.next=27;break;case 23:r.prev=23,r.t0=r.catch(3),t=!0,a=r.t0;case 27:r.prev=27,r.prev=28,e||null==c.return||c.return();case 30:if(r.prev=30,!t){r.next=33;break}throw a;case 33:return r.finish(30);case 34:return r.finish(27);case 35:return r.abrupt("return",Promise.resolve({matchedCampaign:null}));case 36:case"end":return r.stop()}},_callee7,null,[[3,23,27,35],[28,,30,34]])}));return function evaluateCampaigns(){return e.apply(this,arguments)}}(),s.next=8,a();case 8:return s.abrupt("return",s.sent);case 9:case"end":return s.stop()}},_callee8)}));return function findFirstEligibleCampaignId(){return e.apply(this,arguments)}}(),Ze=function(){var e=Object(c.a)(r.a.mark(function _callee9(){var e,t,n,a,c,o,s,i,u,l,d,p;return r.a.wrap(function _callee9$(r){for(;;)switch(r.prev=r.next){case 0:if(e=J.a.getState(),t=e.embed,(n=Object(v.a)([],["configuration","rules"],t))&&n.length){r.next=4;break}return r.abrupt("return",[]);case 4:return a=[],r.next=7,Je();case 7:c=r.sent,o=!0,s=!1,i=void 0,r.prev=11,u=n[Symbol.iterator]();case 13:if(o=(l=u.next()).done){r.next=23;break}return d=l.value,r.next=17,Pe({conditions:d.conditions,context:c});case 17:p=r.sent,p.matched&&a.push(d);case 20:o=!0,r.next=13;break;case 23:r.next=29;break;case 25:r.prev=25,r.t0=r.catch(11),s=!0,i=r.t0;case 29:r.prev=29,r.prev=30,o||null==u.return||u.return();case 32:if(r.prev=32,!s){r.next=35;break}throw i;case 35:return r.finish(32);case 36:return r.finish(29);case 37:return r.abrupt("return",a);case 38:case"end":return r.stop()}},_callee9,null,[[11,25,29,37],[30,,32,36]])}));return function evaluateConversationRoutingConditions(){return e.apply(this,arguments)}}(),Xe="EVALUATED",et="PENDING",tt="MATCH",nt="NO_MATCH",at="POTENTIAL_MATCH",rt=function _addEvaluationResultToAuditLog(e){var t=e.auditLog,n=e.isServerGenerated,a=void 0===n||n,r=e.evaluationResults,c=void 0===r?[]:r,o=e.didMatch,s=e.campaignId,i=e.priority,u=e.status,l=void 0===u?Xe:u;if(t.conditionGroups){var d=a?ct(c):c;t.conditionGroups.push({status:l,matched:o,conditionSets:d,key:s,priority:i})}},ct=function _generateAuditLogForServerEvaluationResults(e){return Object(te.a)(function(e){return e.evaluatedTargetConditionSet},e).map(function(e){return st(e)})},ot=function(){var e=Object(c.a)(r.a.mark(function _callee2(e){var t,n,a,o,s,i,u=arguments;return r.a.wrap(function _callee2$(l){for(;;)switch(l.prev=l.next){case 0:if(t=u.length>1&&void 0!==u[1]?u[1]:function(){},n=Object(oe.m)(),a=function(){var a=Object(c.a)(r.a.mark(function _callee(){var a;return r.a.wrap(function _callee$(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,Je();case 2:return a=r.sent,r.next=5,e.evaluator(a);case 5:if(r.sent.conditionEvaluation){r.next=8;break}return r.abrupt("return");case 8:e.eventType&&(Object(A.a)({topic:"remove-host-event-listener",message:{id:n,event:e.eventType}}),t());case 9:case"end":return r.stop()}},_callee)}));return function asyncConditionHandler(){return a.apply(this,arguments)}}(),!e.timer){l.next=12;break}return l.next=6,Je();case 6:o=l.sent,s=e.conditionDefinition.value,(i=s-e.selector(o))>0&&setTimeout(a,1e3*i+1e3),l.next=13;break;case 12:Object(A.a)({topic:"add-host-event-listener",message:{id:n,event:e.eventType,handler:a}});case 13:case"end":return l.stop()}},_callee2)}));return function _waitForCondition(t){return e.apply(this,arguments)}}(),st=function _generateAuditLogResultForConditionSet(e){var t=Object(v.a)({},["evaluatedTargetCondition","condition"],e),n=Object(v.a)(!1,["evaluatedTargetCondition","matched"],e),a=Object(v.a)(null,["evaluatedTargetCondition","actualValue"],e);return{status:Xe,targetingConditions:[{evaluatedCondition:t,matched:n,actualValue:a,status:Xe,meta:{}}]}},it=function(){var e=Object(c.a)(r.a.mark(function _callee3(e){var t,n,a,c,s,i,u,l,d,p,f,b,h,v,g,O,m,j,_,y,w,k,x,C,E,I,S,A,T,M,P;return r.a.wrap(function _callee3$(r){for(;;)switch(r.prev=r.next){case 0:t=e.conditions,n=void 0===t?[]:t,a=e.onMatched,c=void 0===a?function(){}:a,s=e.onDidNotMatch,i=void 0===s?function(){}:s,u={conditionGroups:[]},l=[],d=function onConditionMatched(e){return c&&c(e),Promise.resolve({TAL:u,matched:!0})},p=function onNoConditionMatched(){return i&&i(),Promise.resolve({TAL:u,matched:!1})},f=!0,b=!1,h=void 0,r.prev=8,v=n.entries()[Symbol.iterator]();case 10:if(f=(g=v.next()).done){r.next=52;break}if(O=g.value,m=Object(o.a)(O,2),j=m[0],_=m[1],y=_.campaignId,w=_.evaluationMatchOutcome,k=_.evaluationResults,x=void 0===k?[]:k,w!==nt){r.next=20;break}rt({evaluationResults:x,auditLog:u,didMatch:!1,campaignId:y,priority:j+1}),r.next=45;break;case 20:if(w!==tt){r.next=25;break}return rt({evaluationResults:x,auditLog:u,didMatch:!0,campaignId:y,priority:j+1}),r.abrupt("return",d(y));case 25:if(w!==at){r.next=45;break}return C=x.filter(function(e){return!e.allConditionsFullyEvaluated&&e.allConditionsPotentiallyMatched}),E=Object(ee.a)(C.map(function(e){return e.evaluatedTargetConditionSet}).filter(function(e){return!e.fullyEvaluated})),I=E.map(function(e){return e.evaluatedTargetCondition}).map(function(e){return e.condition}),r.next=31,Je();case 31:return S=r.sent,r.next=34,Pe({conditions:[I],context:S});case 34:if(A=r.sent,T=A.matched,M=A.asyncConditionListeners,P=A.evalLog,rt({auditLog:u,evaluationResults:void 0===P?[]:P,didMatch:T,campaignId:y,priority:j+1,isServerGenerated:!1,status:M.length?et:Xe}),!T){r.next=44;break}return r.abrupt("return",d(y));case 44:l=[].concat(Object(V.a)(l),Object(V.a)(M));case 45:if(j!==n.length-1){r.next=49;break}if(l.forEach(function(e){return ot(e,function(){return it({conditions:n,onMatched:d,onDidNotMatch:p})})}),l.length){r.next=49;break}return r.abrupt("return",p());case 49:f=!0,r.next=10;break;case 52:r.next=58;break;case 54:r.prev=54,r.t0=r.catch(8),b=!0,h=r.t0;case 58:r.prev=58,r.prev=59,f||null==v.return||v.return();case 61:if(r.prev=61,!b){r.next=64;break}throw h;case 64:return r.finish(61);case 65:return r.finish(58);case 66:return r.abrupt("return",p());case 67:case"end":return r.stop()}},_callee3,null,[[8,54,58,66],[59,,61,65]])}));return function evaluateCampaignTargetingConditions(t){return e.apply(this,arguments)}}(),ut=function(){var e=Object(c.a)(r.a.mark(function _callee(e){var t,n,a;return r.a.wrap(function _callee$(r){for(;;)switch(r.prev=r.next){case 0:if(t=e.forceShow,n=function dispatchWidgetTargetingResult(e,t){J.a.dispatch(Object(I.e)({matchedTargeting:t,matchedHours:e}))},!(void 0!==t&&t)){r.next=6;break}n(!0,!0),r.next=11;break;case 6:return r.next=8,fe();case 8:return a=r.sent,r.next=11,Ye({onMatched:function onMatched(){return n(a,!0)},onDidNotMatch:function onDidNotMatch(){return n(a,!1)}});case 11:case"end":return r.stop()}},_callee)}));return function evaluateWidgetTargeting(t){return e.apply(this,arguments)}}(),lt=function(){var e=Object(c.a)(r.a.mark(function _callee2(e){var t,n,a,c,o,s,i,u,l,d,p,b,h,g,m,j,_,y,w,k,x;return r.a.wrap(function _callee2$(r){for(;;)switch(r.prev=r.next){case 0:if(t=e.hasActiveConversation,n=e.shouldEvalCampaignTargeting,a=e.forceShow,c=e.onDidNotMatch,o=void 0===c?function(){}:c,ut({forceShow:a}),s=J.a.getState(),t||!n){r.next=29;break}return i=s.embed.id,u=s.session,l=u.campaignRefreshToken,d=u.geo,p=u.context,b=u.assignedAgentId,h=Object(O.a)(d)?void 0:d,g=Object(v.a)("",["page","rawUrl"],p),m=function onCampaignMatch(e){var t=Object(v.a)({},["embed","configuration","team",0,"id"],s);ae(e,t,l)},r.prev=9,r.next=12,Object(re.e)({embedId:i,sessionId:l,location:h,pageUrl:g,assignedAgentId:b});case 12:return j=r.sent,_=j.data,r.next=16,it({conditions:_.campaignTargetingResults,onMatched:m,onDidNotMatch:o});case 16:if(y=r.sent,!(w=y.TAL).conditionGroups.length){r.next=24;break}return r.next=21,Object(re.f)(Object(f.a)({},w,dt()));case 21:k=r.sent,x=k.data,J.a.dispatch(Object(X.c)({campaignEvalId:x.targetingEvaluationUUID}));case 24:r.next=29;break;case 26:r.prev=26,r.t0=r.catch(9),Object(oe.e)(new Error("Failed to evaluate campaign targeting - ".concat(r.t0.message)),r.t0);case 29:case"end":return r.stop()}},_callee2,null,[[9,26]])}));return function evalTargetingAndEnrollment(t){return e.apply(this,arguments)}}(),dt=function getTargetingEvaluationMetadata(){var e=J.a.getState(),t=e.session,n=e.embed;return{targetingContext:{endUserId:Object(v.a)(void 0,["endUser","id"],t),orgId:n.orgId},evaluationOptions:{ignoreUnknowns:!1}}},pt=function getConditionsForConditionalSkillTargeting(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return Object(ee.a)(Object(te.a)(function(e){return e.conditionSets},e))},ft=function getEncryptedIntelTargetingConditions(){var e=Object(v.a)({},["embed","configuration"],J.a.getState()),t=e.campaigns,n=void 0===t?[]:t,a=e.rules,r=void 0===a?[]:a,c=e.theme,o=void 0===c?{}:c,s=n.map(function(e){return e.conditions}),i=r.map(function(e){return e.conditions}),u=Object(ee.a)([].concat(Object(V.a)(s),Object(V.a)(i),Object(V.a)(o.conditions)));return bt(u)},bt=function getEncryptedIntelConditionValues(e){var t=ht(e);return Object(g.a)(t.map(function(e){return e.value}))},ht=function getEncryptedIntelConditions(e){return e.filter(function(e){return"clearbit"===e.field||"demandbase"===e.field})},vt=n("ah2r"),gt=n("PrlS"),Ot=n("voeg"),mt=n("hm8b"),jt=n("3kqR"),_t=Object.freeze({welcomeMessage:"welcomeMessage",awayMessage:"awayMessage",emailCaptureMessage:"emailCaptureMessage",thankYouMessage:"confirmationMessage"}),yt=function track(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{Object(G.a)(e,t)}catch(n){Object(oe.j)({data:[n],type:"warn"})}},wt=function showWidget(){It(),J.a.dispatch(Object(I.a)({chatOpen:!0}))},kt=function hideWidget(){J.a.dispatch(Object(I.a)({chatOpen:!1}))},xt=function(){var e=Object(c.a)(r.a.mark(function _callee(){var e,t,n;return r.a.wrap(function _callee$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,Object(gt.b)();case 2:return e=a.sent,J.a.dispatch(Object(Z.g)(e)),yt("Page"),a.next=7,Object(A.a)({topic:"reset-campaign-refresh-token"});case 7:t=a.sent,n=t.data,J.a.dispatch(Object(Z.r)(Object(oe.m)())),J.a.dispatch(Object(Z.q)(n)),lt({hasActiveConversation:J.a.getState().conversations.activeConversation});case 12:case"end":return a.stop()}},_callee)}));return function page(){return e.apply(this,arguments)}}(),Ct=function(){var e=Object(c.a)(r.a.mark(function _callee2(e){var t;return r.a.wrap(function _callee2$(n){for(;;)switch(n.prev=n.next){case 0:if((t=(e||{}).interactionId)||Object(F.a)(Number,t)){n.next=3;break}return n.abrupt("return");case 3:return n.next=5,Object(H.a)(t,{isTriggeredFromAPI:!0});case 5:case"end":return n.stop()}},_callee2)}));return function startInteraction(t){return e.apply(this,arguments)}}(),Et=function(){var e=Object(c.a)(r.a.mark(function _callee3(){var e,t,n,a,c,o=arguments;return r.a.wrap(function _callee3$(r){for(;;)switch(r.prev=r.next){case 0:return e=o.length>0&&void 0!==o[0]?o[0]:"",r.prev=1,r.next=4,Object(H.b)(e,{isTriggeredFromAPI:!0});case 4:return t=r.sent,n=t.data,r.next=8,Object(H.d)(n.conversationId);case 8:a=r.sent,c=a.data,J.a.dispatch(Object(q.d)({conversation:c})),J.a.dispatch(Object(q.k)({conversationId:n.conversationId})),r.next=16;break;case 14:r.prev=14,r.t0=r.catch(1);case 16:case"end":return r.stop()}},_callee3,null,[[1,14]])}));return function goToNewConversation(){return e.apply(this,arguments)}}(),It=function show(){Object(A.a)({topic:"set-frame-height",message:{name:"controller",height:"76px",max:!1}})},St=function(){var e=Object(c.a)(r.a.mark(function _callee4(e,t){var n,a,c;return r.a.wrap(function _callee4$(r){for(;;)switch(r.prev=r.next){case 0:return n=Object(v.a)(null,["session","endUser","email"],J.a.getState()),wt(),r.prev=2,r.next=5,Object(H.c)(n,e,t);case 5:a=r.sent,c=a.data.conversationId,J.a.dispatch(Object(q.k)({conversationId:c})),Object(S.g)(e),r.next=14;break;case 11:r.prev=11,r.t0=r.catch(2),Object(oe.j)({data:[r.t0],type:"warning"});case 14:case"end":return r.stop()}},_callee4,null,[[2,11]])}));return function scheduleMeeting(t,n){return e.apply(this,arguments)}}(),At=function hideChat(){return kt()},Tt={identify:function(){var e=Object(c.a)(r.a.mark(function _callee5(e){var t,n,a,c=arguments;return r.a.wrap(function _callee5$(r){for(;;)switch(r.prev=r.next){case 0:return t=c.length>1&&void 0!==c[1]?c[1]:{},n=c.length>2&&void 0!==c[2]?c[2]:{},r.prev=2,a=Object(W.a)(["hasProvidedIdentity"],t),r.next=6,Object(Q.b)(a,e,n);case 6:t.email&&J.a.dispatch(Object(Z.i)({endUser:{email:t.email}})),r.next=12;break;case 9:r.prev=9,r.t0=r.catch(2),Object(oe.j)({data:[r.t0],type:"warning"});case 12:case"end":return r.stop()}},_callee5,null,[[2,9]])}));return function identify(t){return e.apply(this,arguments)}}(),config:function config(e){if(!Object(F.a)(Object,e))return!1;var t=e.cookieDomain;if(t){var n=Object(vt.e)([t]);n&&J.a.dispatch(Object(Z.h)({cookieDomain:n}))}var a=function configOptionsToEmbedConfiguration(e){var t={theme:{}};if(Object(mt.a)(e))return t;var n=e.locale,a=e.enableWelcomeMessage,r=e.enableCampaigns,c=e.enableChatTargeting,o=e.backgroundColor,s=e.foregroundColor,i=e.activeColor,u=e.textColor,l=e.widgetBackgroundColor,d=e.autoAssigneeId,p=e.autoAssignee,f=e.inboxId,b=e.enabled,h=e.profileMode,v=e.messages,g=e.cookieDomain;return n&&(t.locale=n),Object(mt.a)(a)||(t.theme.showWelcomeMessage=!!a),Object(mt.a)(r)||(t.campaignsEnabled=r),!1===c&&(t.theme.audience="EVERYONE",t.theme.conditions=[]),o&&(t.theme.backgroundColor=o.replace("#","")),s&&(t.theme.foregroundColor=s.replace("#","")),i&&(t.theme.activeColor=i.replace("#","")),u&&(t.theme.textColor=u.replace("#","")),l&&(t.theme.widgetBackgroundColor=l.replace("#","")),Object(mt.a)(d)||(t.autoAssigneeId=d),Object(mt.a)(p)||(t.autoAssignee=p),f&&(t.inboxId=f),Object(mt.a)(b)||(t.enabled=!!b),Object(mt.a)(h)||(t.profileMode=!!h),Object(mt.a)(v)||Object(jt.a)(function(e,n){v[n]&&(t.theme[e]=v[n])},_t),Object(mt.a)(g)||(t.theme.cookieDomains=[g]),t}(e);J.a.dispatch(function receiveEmbedConfigurationOverride(e){return Object(Y.a)({type:"RECEIVE_EMBED_CONFIGURATION_OVERRIDE",payload:e})}(a))},track:yt,reset:function reset(){Object(m.a)(z.a).forEach(function(e){Object(vt.a)(e)}),Object(A.a)({topic:"reload-all-frames",message:{}})},debug:function debug(){console.warn("drift.debug is not supported in this release.")},show:It,ping:function ping(){console.warn("drift.ping is not supported in this release.")},page:xt,hide:function hide(){At(),Object(A.a)({topic:"set-frame-height",message:{name:"controller",height:"0px",max:!1}})},off:function off(){},on:function on(){},startInteraction:Ct,goToConversation:function goToConversation(e){J.a.dispatch(Object(q.k)({conversationId:e})),wt()},goToConversationList:function goToConversationList(){var e=J.a.getState().conversations;Object(O.a)(e.conversations)||(wt(),J.a.dispatch(Object(I.c)({conversationHistoryOpen:!0})))},goToNewConversation:Et,hideAwayMessage:function hideAwayMessage(){return kt()},hideChat:At,hideWelcomeMessage:function hideWelcomeMessage(){return kt()},openChat:function openChat(){return wt()},scheduleMeeting:St,setUserAttributes:function(){var e=Object(c.a)(r.a.mark(function _callee6(e){return r.a.wrap(function _callee6$(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(Q.b)(e);case 2:case"end":return t.stop()}},_callee6)}));return function setUserAttributes(t){return e.apply(this,arguments)}}(),showAwayMessage:function showAwayMessage(e){J.a.dispatch(Object(q.a)()),J.a.dispatch(Object(X.a)()),J.a.dispatch(Object(I.e)({matchedHours:!1,matchedTargeting:!0})),e&&"string"===typeof e&&e.length&&J.a.dispatch(function receiveEmbedAwayMessage(e){return Object(Y.a)({type:"RECIEVE_EMBED_AWAY_MESSAGE",payload:e})}({message:e})),It(),J.a.dispatch(Object(I.a)({chatOpen:!0}))},showWelcomeMessage:function showWelcomeMessage(e){J.a.dispatch(Object(q.a)()),J.a.dispatch(Object(X.a)()),J.a.dispatch(Object(I.e)({matchedHours:!0,matchedTargeting:!0})),e&&"string"===typeof e&&e.length&&J.a.dispatch(function receiveEmbedWelcomeMessage(e){return Object(Y.a)({type:"RECEIVE_EMBED_WELCOME_MESSAGE",payload:e})}({message:e})),It(),J.a.dispatch(Object(I.a)({chatOpen:!0}))},showWelcomeOrAwayMessage:function showWelcomeOrAwayMessage(){J.a.dispatch(Object(q.a)()),wt()},startVideoGreeting:function startVideoGreeting(){console.warn("drift.startVideoGreeting is not supported in this release.")},evaluateCampaignTargeting:function evaluateCampaignTargeting(){lt({hasActiveConversation:!1})},toggleHoursAndTargeting:function toggleHoursAndTargeting(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];J.a.dispatch(Object(I.e)({matchedHours:e,matchedTargeting:!0}))},waitForUserJwt:function waitForUserJwt(){try{J.a.dispatch(Object(Z.s)())}catch(e){Object(oe.j)({data:[e],type:"warning"})}},setUserJwt:function setUserJwt(e){try{J.a.dispatch(Object(Z.l)(e))}catch(t){Object(oe.j)({data:[t],type:"warning"})}}},Mt=function handleApiEvent(e){var t=e.data,n=t.method,a=t.args;Tt[n]&&Object(Ot.b)("API Event Fired",{method:n,arguments:JSON.stringify(a)}),Tt[n]&&Tt[n].apply(Tt,Object(V.a)(a))},Pt=function(){var e=Object(c.a)(r.a.mark(function _callee(){var e,t;return r.a.wrap(function _callee$(n){for(;;)switch(n.prev=n.next){case 0:if(e=Object(v.a)(!1,["embed","configuration","theme","soundNotificationEnabled"],J.a.getState()),t=J.a.getState().view.chatOpen,!e){n.next=5;break}return n.next=5,Object(A.a)({topic:"play-host-notification",message:{chatOpen:t}});case 5:case"end":return n.stop()}},_callee)}));return function playSoundNotification(){return e.apply(this,arguments)}}(),Rt=n("oCA+"),Nt=function WidgetIcon(){var e=Object(B.a)(),t=e.hoverProps,n=e.isHovered,a=Object(d.b)(),r=Object(d.c)(function(e){return e.view.chatOpen}),c=Object(d.c)(function(e){return e.session.gdpr}),o=Object(d.c)(function(e){return!!e.conversations.activeConversation}),s=Object(d.c)(function(e){return!!e.campaigns.activeCampaign}),i=Object(d.c)(function(e){return e.view.matchedTargeting}),p=Object(d.c)(function(e){return Object(v.a)(!1,["embed","configuration","theme"],e)}).unreadBadgeEnabled,b=Object(d.c)(function(e){return e.conversations}).activeConversation,O=Object(d.c)(function(e){return Object(v.a)([],["conversations","unreadAgentMessages",b],e)}),m=Object($.a)(),j=k(m),_=Object(L.a)(),y=_.backgroundStyles,w=_.widgetSecondaryColor,C=Object(u.useMemo)(function(){return n?Object(Rt.c)(y.background,-35):y.background},[n,y]),E=D(),T=E.Icon,M=E.customIcon,V=E.hasCustomIcon,F=Object(U.a)(),W=F.senderId,H=F.type,G=Object(x.a)().markAsRead,J=W||Object(v.a)(void 0,["authorId"],m),z=O?Object(g.a)(O).length:0,q="SLIDER"===H,Y=q&&W,K=J&&O.length>0;return Object(u.useEffect)(function(){Object(A.a)({topic:"toggle-widget-controller",message:{open:r,hasActiveConversation:o&&c.hasConsent}})},[r,c,o]),Object(u.useEffect)(function(){i&&!s&&It()},[i,s]),Object(u.useEffect)(function(){O&&O.length>0&&Pt()},[O]),i||s||r?l.a.createElement("main",{role:"main","aria-label":"drift-controller-main"},c.hasConsent&&l.a.createElement(P,{open:r}),l.a.createElement("button",Object.assign({className:h()("drift-widget-controller",{"drift-widget-controller--closed":r,"drift-widget-controller--custom-icon":V,"drift-widget-controller--avatar":K}),onClick:function onToggleChat(){q||(r||(G(b),z>0&&j&&Object(S.l)(m)),function toggle(e){q?Object(A.a)({topic:"set-frame-url",message:{name:"slider",path:"core/slider/open"}}):a(Object(I.a)({chatOpen:e})),e&&Object(A.a)({topic:"reset-controller-size"})}(!r))},style:K&&!r?{}:Object(f.a)({background:"".concat(C)},M)},t,{"aria-label":r?"close chat":"open chat"}),l.a.createElement("div",{className:"drift-widget-controller-icon"},l.a.createElement("div",{className:"drift-controller-icon--active"},!V&&!K&&(Y?l.a.createElement(N.m,{fill:w}):T),K&&l.a.createElement(R.a,{className:"drift-controller-icon--avatar",id:J})),l.a.createElement("div",{className:"drift-controller-icon--close",style:{backgroundColor:w}})),p&&O.length>0&&l.a.createElement("div",{className:"drift-controller-icon-unread"},Math.min(z,99)))):null},Ut=function UseRemoveActiveCampaign(){Object(A.b)({topic:"CONDUCTOR:remove-active-campaign",handler:function handler(e){J.a.dispatch(Object(X.a)())}})},Lt=function UseStateSnapShot(){return Object(A.b)({topic:"CONDUCTOR:request-state-from-controller",handler:function handler(e){var t=e.data,n=J.a.getState();Object(A.a)({topic:"".concat(t.name,":state-snap-shot"),message:{state:Object(f.a)({},Object(W.a)(["session"],n),{session:Object(W.a)(["sockets"],n.session)})}})}}),J.a},Dt=n("T02G"),Bt=n("6BAR"),$t=n("H/qh"),Vt=n("NFvl"),Ft=n("A5mO"),Wt=function getEmbedConfiguration(e){return ne.l.get("/embeds/".concat(e,".json"))},Ht=n("rWtA"),Gt=["BE","BG","CZ","DK","DE","EE","IE","EL","ES","FR","HR","IT","CY","LV","LT","LU","HU","MT","NL","AT","PL","PT","RO","SI","SK","FI","SE","GB"],Jt=["CA"],zt={EU:Gt,CANADA:Jt,EU_CANADA:[].concat(Jt,Gt),NONE:"NONE",ALL:"ALL"},qt={googleAnalyticsSettings:!0},Yt=n("uIJS"),Kt=n("wQh9"),Qt=n("qytN"),Zt=n("7jL2"),Xt=n("LvsC"),en=n("7VeV"),tn=n("N4Yp"),nn=T.a.get,an=function(){var e=Object(c.a)(r.a.mark(function _callee(){var e,t,n,a,c,o;return r.a.wrap(function _callee$(r){for(;;)switch(r.prev=r.next){case 0:return e=J.a.getState(),t=e.session,n=e.conversations,r.next=3,nn("visitCounts");case 3:return a=r.sent,c=a.data,o=Object(W.a)(["rawUrl"],t.context.page),r.abrupt("return",{engagement:{activeConversation:n.endUserEngaged},page:o,location:cn(t.geo),session:rn(t.context,c)});case 7:case"end":return r.stop()}},_callee)}));return function generatePresenceContext(){return e.apply(this,arguments)}}(),rn=function _hydrateSessionPresenceData(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return{numPageViews:Object(v.a)(0,["total"],t),numSessions:Object(v.a)(0,["total"],t),currentSessionStartedAt:e.currentSessionStartedAt,currentPageViewStartedAt:e.currentPageViewStartedAt,previousSessionStartedAt:Object(v.a)(null,["lastVisit"],t),previousSessionEndedAt:null,firstSessionAt:Object(v.a)(null,["firstVisit"],t),activeSessionStartedAt:e.activeSessionStartedAt}},cn=function _hydrateGeoPresenceData(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{ip:e.ip,city:e.city,subdivision:e.subdivision,country:e.country,countryCode:e.countryCode,gdprApplicable:e.gdprApplicable,metroCode:e.metroCode,postalCode:e.postalCode,latLong:{lat:e.latitude,lon:e.longitude}}},on=n("Gzp1"),sn=n("8SHQ"),un=n("fBUP"),ln=function OpenSocket(e){var t=e.session_token,n=e.org_id,a=e.socketCluster,r=e.ip,c=sn.a.WS_PROTOCOL,o="LOCAL"===sn.a.WS_USER_ENV?"":"".concat(n,"-"),s=pn(n,o,a),i="".concat(c,"://").concat(s,"/ws"),u=new on.Socket(i,{params:{session_token:t,remote_ip:r},timeout:1e4,reconnectAfterMs:function reconnectAfterMs(e){return[1e3,2e3,5e3,1e4][e-1]||1e4},rejoinAfterMs:function rejoinAfterMs(e){return[1e3,2e3,5e3][e-1]||1e4}});return u.connect(),u.onError(function(e){Object(oe.j)({data:["Failed to connect to socket: ".concat(i),e]})}),u.onClose(function(){return Object(oe.j)({data:["socket ".concat(i," has closed")]})}),u},dn=function(){var e=Object(c.a)(r.a.mark(function _callee2(e){var t,n,a,o;return r.a.wrap(function _callee2$(s){for(;;)switch(s.prev=s.next){case 0:return t=e.channelName,n=e.socket,a=e.events,o=new Promise(function(){var e=Object(c.a)(r.a.mark(function _callee(e,c){var o;return r.a.wrap(function _callee$(r){for(;;)switch(r.prev=r.next){case 0:o=n.channel(t),a.forEach(function(e){var t=e.topic,n=e.event;o.on(t,n)}),o.join().receive("ok",function(){e({channel:o})}).receive("error",function(e){Object(oe.j)({data:["Error connecting to channel: ".concat(t)]}),c(e)}).receive("timeout",function(e){Object(oe.j)({data:["Joining the ".concat(t," channel timed out. ")]})});case 3:case"end":return r.stop()}},_callee)}));return function(t,n){return e.apply(this,arguments)}}()),s.abrupt("return",o);case 3:case"end":return s.stop()}},_callee2)}));return function JoinChannel(t){return e.apply(this,arguments)}}(),pn=function _resolveSocketBaseForType(e,t,n){switch(n){case Vn.CHAT:return"".concat(Object(un.d)(e));case Vn.USER:return sn.a.WS_USER_BASE;case Vn.PRESENCE:return"".concat(t).concat(Object(un.c)(e));case Vn.VISITOR_PRESENCE:return sn.a.WS_VISITOR_PRESENCE_BASE;default:return""}},fn=n("TbSn"),bn=function showMostRecentUnreadCampaign(e){var t=J.a.getState().conversations,n=t.activeCampaign,a=t.activeDriftlink;if(!n&&!a){var r=e.conversation,c=void 0===r?{}:r,o=e.messages,s=void 0===o?[]:o;J.a.dispatch(Object(q.d)({conversation:{conversation:c}})),J.a.dispatch(Object(q.g)({conversationId:c.id,messages:s})),J.a.dispatch(Object(q.k)({conversationId:c.id})),J.a.dispatch(Object(X.b)({data:s[0]}))}},hn=function evaluateCampaignConversations(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).campaigns,t=(void 0===e?[]:e).filter(function(e){return function isBotCampaign(e){return"CHAT"===Object(v.a)(null,["conversation","type"],e)}(e)&&function isFirstMessageUnread(e){var t=e.messages.filter(function(e){return""!==e.body});return"Read"!==Object(v.a)(null,[0,"viewerRecipientStatus"],t)}(e)});J.a.dispatch(Object(X.e)(t))},vn=function(){var e=Object(c.a)(r.a.mark(function _callee(){var e,t,n,a,c,o,s,i,u,l;return r.a.wrap(function _callee$(r){for(;;)switch(r.prev=r.next){case 0:return e=J.a.getState(),t=e.campaigns,n=void 0===t?{}:t,a=J.a.getState().conversations.conversations,c=n.unreadCampaigns,s=(o=void 0===c?[]:c).map(function(e){return e.conversation.campaignId}),r.next=6,Qe(s);case 6:i=r.sent,(u=i.matchedCampaign)&&(l=o.filter(function(e){return e.conversation.campaignId===u})[0])&&bn(l),lt({hasActiveConversation:!1,shouldEvalCampaignTargeting:!u,forceShow:!1,onDidNotMatch:function onDidNotMatch(){Object(O.a)(a)||J.a.dispatch(Object(q.e)({conversation:Object(fn.a)(Object(m.a)(a))}))}});case 10:case"end":return r.stop()}},_callee)}));return function handleChatBootstrapComplete(){return e.apply(this,arguments)}}(),gn="emailCapture",On="conversationPermaclose",mn="campaign-conversations",jn="campaign-enrollment",_n="bootstrap:complete",yn="bootstrap:timeout",wn=n("fFuN"),kn=500,xn=new(function(e){function AgentMessageEventBuffer(){var e;return Object(Yt.a)(this,AgentMessageEventBuffer),(e=Object(Qt.a)(this,Object(Zt.a)(AgentMessageEventBuffer).call(this,kn)))._publishBuffer=function(){e._events.length&&(function(){var t=Object(c.a)(r.a.mark(function _callee2(){var t,n,a,o,s,i,u,l;return r.a.wrap(function _callee2$(d){for(;;)switch(d.prev=d.next){case 0:t=Object(E.g)(Object(m.a)(e._events)),n=function(){var t=Object(c.a)(r.a.mark(function _callee(t){return r.a.wrap(function _callee$(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,Object(oe.l)(kn);case 2:e._dispatchAgentMessage(t),Object(E.c)(t,"startInteraction")&&!Object(E.c)(t,"campaignId")?(e._openChatWithMessage(t),e._setMessageReadStatus(t,!0)):e._setMessageReadStatus(t);case 5:case"end":return n.stop()}},_callee)}));return function publishEvent(e){return t.apply(this,arguments)}}(),a=!0,o=!1,s=void 0,d.prev=5,i=t[Symbol.iterator]();case 7:if(a=(u=i.next()).done){d.next=14;break}return l=u.value,d.next=11,n(l);case 11:a=!0,d.next=7;break;case 14:d.next=20;break;case 16:d.prev=16,d.t0=d.catch(5),o=!0,s=d.t0;case 20:d.prev=20,d.prev=21,a||null==i.return||i.return();case 23:if(d.prev=23,!o){d.next=26;break}throw s;case 26:return d.finish(23);case 27:return d.finish(20);case 28:case"end":return d.stop()}},_callee2,null,[[5,16,20,28],[21,,23,27]])}));return function handleBufferDelay(){return t.apply(this,arguments)}}()(),e._resetBuffer())},e._openChatWithMessage=function(e){J.a.getState().view.chatOpen||setTimeout(function(){return J.a.dispatch(Object(I.a)({chatOpen:!0}))},500)},e._setMessageReadStatus=function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1]?Object(H.e)(e.conversationId,[e.id]):J.a.dispatch(Object(q.o)({message:e}))},e._dispatchAgentMessage=function(e){J.a.dispatch(Object(q.b)({message:e}))},e}return Object(Xt.a)(AgentMessageEventBuffer,e),AgentMessageEventBuffer}(wn.a)),Cn=/(?:(?:\+?1\s*(?:[.-]\s*)?)?(?:\(\s*([2-9]1[02-9]|[2-9][02-8]1|[2-9][02-8][02-9])\s*\)|([2-9]1[02-9]|[2-9][02-8]1|[2-9][02-8][02-9]))\s*(?:[.-]\s*)?)?([2-9]1[02-9]|[2-9][02-9]1|[2-9][02-9]{2})\s*(?:[.-]\s*)?([0-9]{4})(?:\s*(?:#|x\.?|ext\.?|extension)\s*(\d+))?/gim,En=function evaluateEndUserResponseChatMessage(e){if(Object(E.c)(e,"buttonClicked")&&Object(S.b)(e),e.body){var t=function extractPhoneNumbers(e){return e?e.match(Cn):null}(e.body);t&&t.length&&t.forEach(function(t){Object(S.k)(e,t)})}},In={SLIDER:function SLIDER(){Object(A.a)({topic:"generate-new-frame",message:{name:"slider",height:"250px",width:"400px",path:"core/slider"}})},TAKEOVER:function TAKEOVER(){Object(A.a)({topic:"generate-new-frame",message:{name:"takeover",height:"100%",width:"100%",path:"core/takeover"}})},EMAIL_CAPTURE:function EMAIL_CAPTURE(){Object(A.a)({topic:"generate-new-frame",message:{name:"emailCapture",height:"300px",width:"450px",path:"core/email-capture"}})},WELCOME_MESSAGE:function WELCOME_MESSAGE(){J.a.dispatch(Object(q.a)()),J.a.dispatch(Object(I.a)({chatOpen:!0})),J.a.dispatch(Object(I.e)({matchedHours:!0,matchedTargeting:!0}))}},Sn=function(){var e=Object(c.a)(r.a.mark(function _callee(e){var t,n,a;return r.a.wrap(function _callee$(r){for(;;)switch(r.prev=r.next){case 0:return t=Object(v.a)([],["attributes","conditionSetsToEvaluate"],e),r.next=3,Ke(t);case 3:n=r.sent,a={requestingMessageId:e.id,conversationId:e.conversationId,targetingRequestPayload:n};try{Object(re.a)(a)}catch(c){Object(Ne.a)(new Error("Failed to evaluate conditional skill"))}case 6:case"end":return r.stop()}},_callee)}));return function evaluateConditionalMessage(t){return e.apply(this,arguments)}}(),An=function evaluateNewMessage(e){var t=Object(v.a)({},["body","data"],e);if(Object(E.c)(t,"widgetGuid"))return En(t);var n=Object(E.c)(t,"startInteraction"),a=Object(E.c)(t,"campaignDisplayType"),r=Object(E.c)(t,"liveViewInitiated"),c=t.contentType===_.b.CONDITIONAL_SKILL_EVAL&&Object(E.c)(t,"conditionSetsToEvaluate"),o=Object(v.a)(!1,["contentType",_.b.CHAT],t)&&!t.body.length;return n&&(Object(S.n)(t),J.a.dispatch(Object(X.b)({data:t}))),Tn(t),a?function evaluateCampaignDisplayMessage(e){J.a.dispatch(Object(X.b)({data:e}));var t=In[e.attributes.campaignDisplayType];t&&t()}(t):r?function evaluateLiveViewMessage(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.id,n=void 0===t?null:t,a=e.conversationId;if(void 0!==a&&a&&n){var r=Object(f.a)({},e.attributes,{senderId:e.authorId}),c=Object(f.a)({},e,{attributes:r});J.a.dispatch(Object(q.a)()),J.a.dispatch(Object(I.a)({chatOpen:!0})),J.a.dispatch(Object(X.b)({data:c}))}}(t):c?Sn(t):Object(E.h)(t)?function evaluateChatMessage(e){var t=e.body.data;xn.push(Object(f.a)({},t,{isWithinSession:!0})),Object(S.i)(t)}(e):o?Object(H.e)(t.conversationId,[t.id]):Object(E.c)(t,"isBot")?function evaluateBotChatMessage(e){if(Object(E.c)(e,"offerSchedule")){var t=e.attributes.offerSchedule;Object(S.g)(t)}}(t):void 0},Tn=function evaluateComposerStateForNewMessage(e){Object(E.c)(e,"permacloseMessage")?J.a.dispatch(Object(I.b)({enabled:!1})):J.a.dispatch(Object(I.b)({enabled:!0}))},Mn={topic:"conversation",event:function event(e){e.conversation&&J.a.dispatch(Object(q.d)({conversation:e.conversation}))}},Pn={topic:mn,event:function event(e){hn(e)}},Rn={topic:jn,event:function event(e){var t=Object.keys(e);J.a.dispatch(Object(X.d)(t))}},Nn={topic:_n,event:function event(){vn()}},Un={topic:yn,event:function event(){!function handleChatBootstrapTimeout(){lt({hasActiveConversation:!1,shouldEvalCampaignTargeting:!0,forceShow:!1})}()}},Ln={topic:On,event:function event(e){J.a.dispatch(Object(I.b)({enabled:!1}))}},Dn=[{topic:"data:sentMessage",event:function event(e){J.a.dispatch(Object(q.f)(e))}}],Bn=[{topic:"typing:started",event:function event(e){window.fallbackTimeout&&clearTimeout(window.fallbackTimeout),J.a.dispatch(Object(q.m)({conversationId:e.conversationId,userId:e.userId,isTyping:!0})),window.fallbackTimeout=setTimeout(function(){J.a.dispatch(Object(q.m)({conversationId:e.conversationId,userId:e.userId,isTyping:!1}))},5e3)}},{topic:"typing:finished",event:function event(e){J.a.dispatch(Object(q.m)({conversationId:e.conversationId,isTyping:!1}))}},{topic:"change",event:function(){var e=Object(c.a)(r.a.mark(function _callee(e){return r.a.wrap(function _callee$(t){for(;;)switch(t.prev=t.next){case 0:"CREATE"===e.body.type&&"MESSAGE"===e.body.object.type&&An(e);case 2:case"end":return t.stop()}},_callee)}));return function onUserChangeEvent(t){return e.apply(this,arguments)}}()},{topic:"event",event:function(){var e=Object(c.a)(r.a.mark(function _callee2(e){var t,n,a;return r.a.wrap(function _callee2$(r){for(;;)switch(r.prev=r.next){case 0:t=e.body,n=t.type,a=t.data,n===gn&&J.a.dispatch(Object(Z.c)(a.email));case 2:case"end":return r.stop()}},_callee2)}));return function onUserTriggeredEvent(t){return e.apply(this,arguments)}}()},Mn,Rn,Un,Nn,Pn,Ln],$n=[],Vn=Object.freeze({CHAT:"chat",USER:"user",PRESENCE:"presence",VISITOR_PRESENCE:"visitor_presence"}),Fn=Object.freeze({CHAT:"chat",USER:"user",ORG_PUBLIC:"live",LIVE:"live"}),Wn=Object.freeze({CHAT:"chat",USER:"user",PRESENCE:"presence"}),Hn=function(){var e=Object(c.a)(r.a.mark(function _callee2(e){var t,n,a,o,s;return r.a.wrap(function _callee2$(i){for(;;)switch(i.prev=i.next){case 0:return t=e.session_token,n=e.org_id,a=e.socketCluster,o=e.ip,s=new Promise(function(){var e=Object(c.a)(r.a.mark(function _callee(e,c){var s;return r.a.wrap(function _callee$(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,ln({session_token:t,org_id:n,socketCluster:a,ip:o});case 2:if(!(s=r.sent)){r.next=7;break}return r.abrupt("return",e(s));case 7:return r.abrupt("return",c("could not connect"));case 8:case"end":return r.stop()}},_callee)}));return function(t,n){return e.apply(this,arguments)}}()),i.abrupt("return",s);case 3:case"end":return i.stop()}},_callee2)}));return function connectToSocket(t){return e.apply(this,arguments)}}(),Gn=function(){var e=Object(c.a)(r.a.mark(function _callee3(e){var t,n,a,c,o,s;return r.a.wrap(function _callee3$(r){for(;;)switch(r.prev=r.next){case 0:return t=e.socket,n=e.socketAuth,a=e.channelEvents,c=e.channelName,o=e.orgId,r.prev=1,r.next=4,dn({channelName:Jn(c,n.user_id,o),socket:t,events:zn(a)});case 4:return s=r.sent,r.abrupt("return",s);case 8:r.prev=8,r.t0=r.catch(1),Object(oe.e)(new Error(r.t0));case 11:case"end":return r.stop()}},_callee3,null,[[1,8]])}));return function connectToChannel(t){return e.apply(this,arguments)}}(),Jn=function _resolveChannelName(e,t,n){switch(e){case Fn.USER:case Fn.CHAT:return"".concat(e,":").concat(t);case Fn.LIVE:return"".concat(e,":").concat(n);default:return""}},zn=function _resolveChannelEvents(e){switch(e){case Wn.CHAT:return Dn;case Wn.USER:return Bn;case Wn.PRESENCE:return $n;default:return[]}},qn=15e3,Yn=function(){function SocketManager(){Object(Yt.a)(this,SocketManager),this._fireChannelConnectedEvent=function(e,t,n){J.a.dispatch(Object(Z.f)(Object(f.a)({key:e,cluster:t},n)))}}return Object(Kt.a)(SocketManager,[{key:"_fireSocketConnectedEvent",value:function _fireSocketConnectedEvent(e){J.a.dispatch(Object(Z.p)({cluster:e}))}}]),SocketManager}(),Kn=new(function(e){function ChatSocketManager(){var e;return Object(Yt.a)(this,ChatSocketManager),(e=Object(Qt.a)(this,Object(Zt.a)(ChatSocketManager).call(this))).throttledPresencePing=Object(en.throttle)(qn,e._sendPresencePing),e._socket=null,e._channel=null,e._heartbeatInterval=null,e}return Object(Xt.a)(ChatSocketManager,e),Object(Kt.a)(ChatSocketManager,[{key:"connect",value:function(){var e=Object(c.a)(r.a.mark(function _callee(e){var t,n,a,c,o=this;return r.a.wrap(function _callee$(r){for(;;)switch(r.prev=r.next){case 0:return t=e.orgId,n=e.accessToken,Object(tn.e)(t),r.next=4,Object(tn.b)({access_token:n});case 4:return a=r.sent,c=a.data,r.next=8,Hn(Object(f.a)({},c,{socketCluster:Vn.CHAT,orgId:t,ip:c.remote_ip}));case 8:return this._socket=r.sent,this._fireSocketConnectedEvent(Vn.CHAT),r.next=12,Gn({socket:this._socket,channelEvents:Wn.USER,socketAuth:c,channelName:Fn.USER,orgId:t});case 12:this._channel=r.sent,this._fireChannelConnectedEvent("user",Vn.CHAT,this._channel),this._channel&&(this._sendPresencePing(),this._channel.channel.on("presence:request_update",function(){o.throttledPresencePing()}));case 15:case"end":return r.stop()}},_callee,this)}));return function connect(t){return e.apply(this,arguments)}}()},{key:"sendChatBootstrapEvent",value:function sendChatBootstrapEvent(e){var t=e.sessionId,n=e.accessToken,a=e.campaignIds;this._channel.channel.push("chat:bootstrap",{sessionId:t,accessToken:n,campaignIds:a})}},{key:"_sendPresencePing",value:function(){var e=Object(c.a)(r.a.mark(function _callee2(){var e,t;return r.a.wrap(function _callee2$(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,an();case 2:e=n.sent,t=e.page,this._channel.channel.push("presence:send_update",{page:t});case 5:case"end":return n.stop()}},_callee2,this)}));return function _sendPresencePing(){return e.apply(this,arguments)}}()}]),ChatSocketManager}(Yn)),Qn=n("4+fu"),Zn=(new(function(e){function UserSocketManager(){var e;return Object(Yt.a)(this,UserSocketManager),(e=Object(Qt.a)(this,Object(Zt.a)(UserSocketManager).call(this))).sendMessage=function(t){e._pushMessageToChannel("request:sendMessage",t)},e._pushMessageToChannel=function(t,n){Object(v.a)(!1,["_channel","channel"],Object(Qn.a)(e))&&e._channel.channel.push(t,n)},e._socket=null,e._channel=null,e._heartbeatInterval=null,e}return Object(Xt.a)(UserSocketManager,e),Object(Kt.a)(UserSocketManager,[{key:"connect",value:function(){var e=Object(c.a)(r.a.mark(function _callee(e){var t,n,a,c;return r.a.wrap(function _callee$(r){for(;;)switch(r.prev=r.next){case 0:return t=e.orgId,n=e.accessToken,Object(tn.f)(),r.next=4,Object(tn.c)({access_token:n});case 4:return a=r.sent,c=a.data,r.next=8,Hn(Object(f.a)({},c,{socketCluster:Vn.USER,orgId:t,ip:c.remote_ip}));case 8:return this._socket=r.sent,this._fireSocketConnectedEvent(Vn.USER),r.next=12,Gn({socket:this._socket,channelEvents:Wn.CHAT,socketAuth:c,channelName:Fn.CHAT,orgId:t});case 12:this._channel=r.sent,this._fireChannelConnectedEvent("chat",Vn.USER,this._channel),this._pushMessageToChannel("data:conversations");case 15:case"end":return r.stop()}},_callee,this)}));return function connect(t){return e.apply(this,arguments)}}()}]),UserSocketManager}(Yn)),new(function(e){function VisitorPresenceSocketManager(){var e;return Object(Yt.a)(this,VisitorPresenceSocketManager),(e=Object(Qt.a)(this,Object(Zt.a)(VisitorPresenceSocketManager).call(this)))._socket=null,e._channel=null,e._heartbeatInterval=null,e}return Object(Xt.a)(VisitorPresenceSocketManager,e),Object(Kt.a)(VisitorPresenceSocketManager,[{key:"connect",value:function(){var e=Object(c.a)(r.a.mark(function _callee(e){var t,n,a,c;return r.a.wrap(function _callee$(r){for(;;)switch(r.prev=r.next){case 0:return t=e.orgId,n=e.accessToken,Object(tn.g)(),r.next=4,Object(tn.d)({access_token:n});case 4:return a=r.sent,c=a.data,r.next=8,Hn(Object(f.a)({},c,{socketCluster:Vn.VISITOR_PRESENCE,orgId:t,ip:c.remote_ip}));case 8:return this._socket=r.sent,this._fireSocketConnectedEvent(Vn.VISITOR_PRESENCE),r.next=12,Gn({socket:this._socket,socketAuth:c,channelEvents:Wn.PRESENCE,channelName:Fn.LIVE,orgId:t});case 12:this._channel=r.sent,this._fireChannelConnectedEvent("user",Vn.VISITOR_PRESENCE,this._channel),this._channel&&(this._updatePresence(),this.startPresenceUpdateHeartbeat());case 15:case"end":return r.stop()}},_callee,this)}));return function connect(t){return e.apply(this,arguments)}}()},{key:"startPresenceUpdateHeartbeat",value:function startPresenceUpdateHeartbeat(){this._heartbeatInterval=setInterval(this._updatePresence.bind(this),qn)}},{key:"_updatePresence",value:function(){var e=Object(c.a)(r.a.mark(function _callee2(){var e;return r.a.wrap(function _callee2$(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,an();case 2:e=t.sent,this._channel.channel.push("heartbeat",e);case 4:case"end":return t.stop()}},_callee2,this)}));return function _updatePresence(){return e.apply(this,arguments)}}()},{key:"stopPresenceUpdateHeartbeat",value:function stopPresenceUpdateHeartbeat(){clearInterval(this._heartbeatInterval)}}]),VisitorPresenceSocketManager}(Yn))),Xn=n("+omm"),ea=n("ljQm"),ta=n("tNhX"),na=function(){var e=Object(c.a)(r.a.mark(function _callee(e){var t,n,a,c;return r.a.wrap(function _callee$(r){for(;;)switch(r.prev=r.next){case 0:if(t=Object(v.a)({},["embed","configuration"],J.a.getState()),n=t.interactionSlugMap,a=void 0===n?{}:n,!(c=e?e.substring(1):null)||!a[c]){r.next=13;break}return r.prev=3,J.a.dispatch(Object(q.l)(e)),r.next=7,Object(H.a)(a[c],{isFromConversationalLandingPage:!1});case 7:r.next=12;break;case 9:r.prev=9,r.t0=r.catch(3),Object(oe.j)({data:[r.t0],type:"warn"});case 12:return r.abrupt("return",!0);case 13:return r.abrupt("return",!1);case 14:case"end":return r.stop()}},_callee,null,[[3,9]])}));return function fireByDriftlink(t){return e.apply(this,arguments)}}(),aa=n("voTE"),ra=n("+PQt"),ca=n("njw0"),oa=T.a.get,sa=T.a.set;function Bootstrap(e){var t=e.embedId,n=e.params;return this.dispatch=J.a.dispatch,this.state=J.a.getState,this.embedId=t,this.params=n,this}Bootstrap.prototype.dataProtection=Object(c.a)(r.a.mark(function _callee(){var e,t,n,a,c,o,s,i,u,l;return r.a.wrap(function _callee$(r){for(;;)switch(r.prev=r.next){case 0:if(e=this.state(),t=e.embed,n=e.session,a=n.gdpr,c=n.geo,o=c.country,s=t.configuration.dataProtection,i=function resolveNeedsConsent(e){return"ALL"===e||!("NONE"===e||!e)&&(!o||Object($t.a)(o,zt[e]))},s){r.next=7;break}return r.abrupt("return",this.dispatch(Object(Z.m)({needsConsent:!1,hasConsent:!0})));case 7:u=i(s.targeting),l=!u||a.hasConsent,this.dispatch(Object(Z.m)({needsConsent:u,hasConsent:l}));case 10:case"end":return r.stop()}},_callee,this)})),Bootstrap.prototype.handleDriftLinks=Object(c.a)(r.a.mark(function _callee2(){var e;return r.a.wrap(function _callee2$(t){for(;;)switch(t.prev=t.next){case 0:if(e=this.params.skipCampaigns,t.t0=!e,!t.t0){t.next=5;break}return t.next=5,this.hasDriftLinkFire();case 5:case"end":return t.stop()}},_callee2,this)})),Bootstrap.prototype.hydrateContext=Object(c.a)(r.a.mark(function _callee3(){var e;return r.a.wrap(function _callee3$(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(gt.b)();case 2:return e=t.sent,this.dispatch(Object(Z.g)(e)),t.abrupt("return",e);case 5:case"end":return t.stop()}},_callee3,this)})),Bootstrap.prototype.sendPageTrackEvent=function(e){Object(G.a)("Page",e.page)},Bootstrap.prototype.countVisit=Object(c.a)(r.a.mark(function _callee4(){var e,t,n,a,c,o,s;return r.a.wrap(function _callee4$(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,Object(A.a)({topic:"access-host-window",message:{key:"location"}});case 2:return e=r.sent,t=e.data,n=void 0===t?{}:t,r.next=7,oa("visitCounts");case 7:a=r.sent,c=a.data,o=c||{},s=Object(Bt.a)(o,function(e){e.total=(e.total||0)+1,e.daysSinceLastVisit=Ft.a.now().since(e.lastVisit||Ft.a.now()).diff.days,e.lastVisit=Ft.a.now().epoch,e.firstVisit=e.firstVisit||Ft.a.now().epoch,e[n.pathname]=(e[n.pathname]||0)+1}),sa("visitCounts",s);case 12:case"end":return r.stop()}},_callee4)})),Bootstrap.prototype.fetchPreRequisiteData=Object(c.a)(r.a.mark(function _callee5(){var e,t,n,a,c,o,s,i,u;return r.a.wrap(function _callee5$(r){for(;;)switch(r.prev=r.next){case 0:return e={},this.dispatch(Object(Z.o)({session:this.params.session})),r.prev=2,r.next=5,Wt(this.embedId);case 5:t=r.sent,n=t.data,a=t.responseTime,c=void 0===a?0:a,e=n,this.dispatch(K(e)),Object(Ot.c)("Bootstrap.embed_fetch",c),r.next=17;break;case 14:r.prev=14,r.t0=r.catch(2),Object(oe.e)(new ca.a("Embed Failed to load correctly - ".concat(r.t0.message)),r.t0);case 17:try{(o=Object(vt.e)(Object(v.a)(null,["configuration","theme","cookieDomains"],e)))&&J.a.dispatch(Object(Z.h)({cookieDomain:o}))}catch(l){Object(oe.e)(new ca.a("Failed to set custom cookie domain - ".concat(l.message)),l)}return r.prev=18,r.next=21,Object(Ht.a)();case 21:s=r.sent,i=s.data,u=s.responseTime,this.dispatch(Object(Z.n)(i)),Object(Ot.c)("Bootstrap.geo_fetch",u),r.next=31;break;case 28:r.prev=28,r.t1=r.catch(18),Object(oe.j)({data:["Geo Failed to load - ".concat(r.t1.message),r.t1]});case 31:case"end":return r.stop()}},_callee5,this,[[2,14],[18,28]])})),Bootstrap.prototype.handleAuthentication=Object(c.a)(r.a.mark(function _callee7(){var e,t,n,a;return r.a.wrap(function _callee7$(o){for(;;)switch(o.prev=o.next){case 0:return e=this.state().embed.orgId,t=null,o.prev=2,o.next=5,Object(aa.c)(Object(c.a)(r.a.mark(function _callee6(){return r.a.wrap(function _callee6$(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(Q.a)({orgId:e});case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}},_callee6)})),"widget_core:identity");case 5:n=o.sent,a=n.result,t=a,o.next=13;break;case 10:o.prev=10,o.t0=o.catch(2),Object(oe.e)(new ca.a("Failed to authenticate end user"),o.t0);case 13:if(t){o.next=15;break}return o.abrupt("return");case 15:return this.dispatch(Object(Z.i)({endUser:t.endUser})),this.dispatch(Object(Z.e)(t)),this.dispatch(Object(Z.m)({hasConsent:t.didConsentToRequestedConsentId||!1})),o.next=20,this.handleSockets({orgId:e,endUserResponse:t});case 20:case"end":return o.stop()}},_callee7,this,[[2,10]])})),Bootstrap.prototype.handleSockets=function(){var e=Object(c.a)(r.a.mark(function _callee8(e){var t,n;return r.a.wrap(function _callee8$(a){for(;;)switch(a.prev=a.next){case 0:return t=e.orgId,n=e.endUserResponse,a.next=3,Object(aa.c)(function(){return Kn.connect({accessToken:n.accessToken,orgId:t})},"widget_core.sockets:chat_connect");case 3:case"end":return a.stop()}},_callee8)}));return function(t){return e.apply(this,arguments)}}(),Bootstrap.prototype.hasDriftLinkFire=Object(c.a)(r.a.mark(function _callee9(){var e,t,n,a,c;return r.a.wrap(function _callee9$(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,Object(A.a)({topic:"get-host-window"});case 2:return e=r.sent,t=e.data,n=void 0===t?{}:t,a=Object(v.a)("",["location","hash"],n),c=na(a),r.abrupt("return",!c);case 8:case"end":return r.stop()}},_callee9)})),Bootstrap.prototype.sendChatBootstrapEvent=Object(c.a)(r.a.mark(function _callee10(){var e,t,n,a;return r.a.wrap(function _callee10$(r){for(;;)switch(r.prev=r.next){case 0:if(e=Object(v.a)(null,["params","session","sessionId"],this)){r.next=3;break}return r.abrupt("return");case 3:t=this.state().embed.configuration,n=this.state().session.auth.accessToken,a=t.campaigns.map(function(e){return e.id}),Kn.sendChatBootstrapEvent({sessionId:e,accessToken:n,campaignIds:a});case 7:case"end":return r.stop()}},_callee10,this)})),Bootstrap.prototype.connectToPresence=function(){var e=this.state().session.auth.accessToken,t=this.state().embed.orgId;t&&e&&Object(aa.c)(function(){return Zn.connect({accessToken:e,orgId:t})},"widget_core.sockets:visitor_presence_connect")},Bootstrap.prototype.attachIntegrations=Object(c.a)(r.a.mark(function _callee11(){var e,t,n;return r.a.wrap(function _callee11$(a){for(;;)switch(a.prev=a.next){case 0:e=this.state().embed.configuration,t=(void 0===e?{}:e).integrations,n=void 0===t?{}:t,Object.keys(n).forEach(function(e){qt[e]&&Object(A.a)({topic:"handle-host-integration",message:{config:n[e],type:e}})});case 3:case"end":return a.stop()}},_callee11,this)})),Bootstrap.prototype.evaluateConversationRouting=Object(c.a)(r.a.mark(function _callee12(){var e;return r.a.wrap(function _callee12$(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,Ze();case 3:e=t.sent,this.dispatch(Object(q.n)(e)),t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),Object(oe.e)("Failed to evaluate conversation routing - ".concat(t.t0));case 10:case"end":return t.stop()}},_callee12,this,[[0,7]])})),Bootstrap.prototype.hydrateTargetingData=Object(c.a)(r.a.mark(function _callee13(){var e,t;return r.a.wrap(function _callee13$(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,e=ft(),t=Le(),n.next=5,Object($e.a)(e);case 5:return n.next=7,Ue(t);case 7:n.next=12;break;case 9:n.prev=9,n.t0=n.catch(0),Object(oe.e)(new ca.a("Failed to hydrate targeting data"),n.t0);case 12:case"end":return n.stop()}},_callee13,null,[[0,9]])})),Bootstrap.prototype.waitForUserJwt=function(){var e=Object(oe.g)(function(){console.warn("Drift Widget is still waiting for user JWT!")},3e4);return new Promise(function(t){var n=J.a.subscribe(Object(c.a)(r.a.mark(function _callee14(){return r.a.wrap(function _callee14$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,Object(Xn.c)();case 2:if(!a.sent){a.next=4;break}return a.abrupt("return");case 4:e(),n(),t();case 7:case"end":return a.stop()}},_callee14)})))})};var ia=function(){var e=Object(c.a)(r.a.mark(function _callee16(e){var t,n,a,o,s,i,u;return r.a.wrap(function _callee16$(l){for(;;)switch(l.prev=l.next){case 0:return t=new Bootstrap(e),n=Object(v.a)(null,["params","session","sessionId"],e),a=Object(v.a)(null,["params","session","instanceId"],e),o=function(){var e=Object(c.a)(r.a.mark(function _callee15(){return r.a.wrap(function _callee15$(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(aa.c)(function(){return t.fetchPreRequisiteData()},"bootstrap: embed/geo");case 3:return e.next=5,Object(Xn.c)();case 5:if(!e.sent){e.next=8;break}return e.next=8,Object(aa.c)(function(){return t.waitForUserJwt()},"bootstrap: waitForUserJwt");case 8:return e.next=10,Object(aa.c)(function(){return t.handleAuthentication()},"bootstrap: endUserAuth");case 10:return e.next=12,t.hydrateTargetingData();case 12:return e.next=14,Object(aa.c)(function(){return t.dataProtection()},"bootstrap: GDPR");case 14:return ua(),e.next=17,t.handleDriftLinks();case 17:t.evaluateConversationRouting(),t.sendChatBootstrapEvent(),t.dispatch(Object(I.d)({initComplete:!0})),e.next=26;break;case 22:e.prev=22,e.t0=e.catch(0),Object(Ot.a)("bootstrap.failure"),Object(oe.e)("Failed to bootstrap - ".concat(e.t0.message),e.t0);case 26:case"end":return e.stop()}},_callee15,null,[[0,22]])}));return function measuredInit(){return e.apply(this,arguments)}}(),l.prev=4,l.next=7,t.countVisit();case 7:return l.next=9,t.hydrateContext();case 9:return s=l.sent,n&&la(e.embedId,n,a,s),l.next=13,Object(aa.c)(o,"bootstrap");case 13:i=l.sent,u=i.timing,Object(Ot.c)("bootstrap",u),t.sendPageTrackEvent(s),t.attachIntegrations(),t.connectToPresence(),Promise.resolve("bootstrap complete"),l.next=26;break;case 22:l.prev=22,l.t0=l.catch(4),Object(oe.e)(new Error(l.t0)),Promise.reject("bootstrap failed");case 26:case"end":return l.stop()}},_callee16,null,[[4,22]])}));return function init(t){return e.apply(this,arguments)}}(),ua=function(){var e=Object(c.a)(r.a.mark(function _callee17(){return r.a.wrap(function _callee17$(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=ta.a,e.t1=ea.b.READY,e.next=4,fe();case 4:return e.t2=e.sent,e.next=7,he();case 7:e.t3=e.sent,e.t4={isOnline:e.t2,teamAvailability:e.t3,sidebarOpen:!1},(0,e.t0)(e.t1,e.t4);case 10:case"end":return e.stop()}},_callee17)}));return function fireWidgetReadyEvent(){return e.apply(this,arguments)}}(),la=function fireWidgetInitEvent(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},r={eventName:"[V2] - init",embedId:e,sessionId:t,instanceId:n,context:{url:Object(Vt.a)(["page","url"],a),hostname:Object(Vt.a)(["page","hostname"],a),timezone:a.timezone}};Object(ra.c)(r).catch(function(e){Object(oe.j)({type:"warn",data:["Failed to send init event"]})})};J.a.name="controller";t.default=Object(p.a)(function WidgetControllerPage(e){var t=e.location,n=Object(u.useState)(!1),a=Object(o.a)(n,2),s=a[0],p=a[1],f=Object(ve.c)(i.a.parse(t.search)),b=Object(oe.m)();return Object(u.useEffect)(function(){if(s){var e=Object(aa.b)("widget_core:widget_loaded");e&&(Object(Ot.c)("loaded",e),Object(Ot.a)("widget.v2.load",!1));var t=J.a.getState().embed,n=void 0===t?{}:t;return Object(Rt.a)(n),void Object(Rt.b)(n)}Object(Dt.a)({name:"controller",syncWith:"chat",store:J.a}),Lt(),Ut(),Object(A.b)({topic:"trigger-api-event",handler:Mt}),Object(A.b)({topic:"identity-provided-email",handler:function handler(e){var t=e.data,n=void 0===t?{}:t;J.a.dispatch(Object(Z.j)(n.email))}}),Object(A.b)({topic:"identity-provided-id",handler:function handler(e){var t=e.data,n=void 0===t?{}:t;J.a.dispatch(Object(Z.k)(n.externalId))}}),Object(A.b)({topic:"identity-provided-jwt",handler:function handler(e){var t=e.data,n=void 0===t?{}:t;J.a.dispatch(Object(Z.l)(n.userJwt))}}),Object(A.b)({topic:"host-hash-change",handler:function handler(e){var t=e.data;return na(t.hash)}}),Object(A.b)({topic:"init-ready",handler:function(){var e=Object(c.a)(r.a.mark(function _callee(){return r.a.wrap(function _callee$(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,e.t0=!s,!e.t0){e.next=5;break}return e.next=5,ia({embedId:f.embedId,params:{skipCampaigns:f.skipCampaigns,forceShow:f.forceShow,session:{sessionId:f.sessionId,sessionStarted:f.sessionStarted,campaignRefreshToken:f.campaignRefreshToken,instanceId:b}}});case 5:p(!0),e.next=11;break;case 8:e.prev=8,e.t1=e.catch(0),console.warn(e.t1);case 11:case"end":return e.stop()}},_callee,null,[[0,8]])}));return function handler(){return e.apply(this,arguments)}}()}),Object(ta.a)(ea.b.API_READY)},[f.embedId,f.forceShow,f.skipCampaigns,s,f.sessionId,f.sessionStarted,f.campaignRefreshToken,b]),l.a.createElement(d.a,{store:J.a},s&&l.a.createElement(Nt,null))})},pUpc:function(e,t,n){},z8n0:function(e,t,n){}}]);